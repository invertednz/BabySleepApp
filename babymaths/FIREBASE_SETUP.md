# Firebase Setup for Baby Maths

This guide configures Firebase for the Baby Maths app (Flutter) under `babymaths/babymaths_app/`.

---

## 1) Create Firebase Project

1. Go to https://console.firebase.google.com
2. Create project: `baby-maths`
3. Enable Google Analytics (optional)

---

## 2) Add iOS and Android Apps

- iOS bundle ID: `com.babymaths.app`
- Android package name: `com.babymaths.app`

Download and place configs:
- `ios/Runner/GoogleService-Info.plist`
- `android/app/google-services.json`

---

## 3) Install FlutterFire CLI

```bash
dart pub global activate flutterfire_cli
```

Configure Firebase for your Flutter app:
```bash
flutterfire configure \
  --project=baby-maths \
  --out=lib/firebase_options.dart
```

This generates `firebase_options.dart` and links platforms.

---

## 4) Flutter Dependencies

Add to `pubspec.yaml`:
```yaml
dependencies:
  firebase_core: ^3.6.0
  firebase_auth: ^5.2.0
  cloud_firestore: ^5.4.4
  firebase_storage: ^12.3.5
  firebase_messaging: ^15.1.3
  firebase_analytics: ^11.3.3
  google_sign_in: ^6.2.1
  # Optional charts/UI libs remain the same
```

Install:
```bash
flutter pub get
```

---

## 5) Initialize Firebase in Flutter

```dart
import 'package:firebase_core/firebase_core.dart';
import 'firebase_options.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await Firebase.initializeApp(
    options: DefaultFirebaseOptions.currentPlatform,
  );
  runApp(const BabyMathsApp());
}
```

- Ensure `firebase_options.dart` is generated by FlutterFire.

---

## 6) Android Gradle Setup

- `android/build.gradle`:
```gradle
buildscript {
  dependencies {
    classpath 'com.google.gms:google-services:4.4.2'
  }
}
```
- `android/app/build.gradle`:
```gradle
apply plugin: 'com.google.gms.google-services'
```

---

## 7) Enable Firebase Products

- Authentication (Email/Password, Google)
- Firestore Database (in Native/Production mode)
- Cloud Storage
- Cloud Functions (Node 20)
- Cloud Messaging (optional, later)
- Analytics

---

## 8) Firestore Structure (Collections)

- `babies/{babyId}`
  - user_id, name, birthdate, gender, current_maths_level, profile_photo_url, created_at, updated_at
- `maths_milestones/{milestoneId}`
  - category, title, description, age_months_min, age_months_max, difficulty_level, activities[], indicators[], next_steps[], sort_order, created_at, updated_at
- `activity_logs/{logId}`
  - baby_id, user_id, milestone_id, activity_title, activity_category, completed_at, duration_minutes, engagement_level, notes, media_urls[]
- `milestone_completions/{completionId}`
  - baby_id, user_id, milestone_id, completed_at, confidence_level, notes
- `daily_activity_suggestions/{suggestionId}`
  - baby_id, user_id, activity_date, suggested_activities[], generated_at
- `weekly_progress_summaries/{summaryId}`
  - baby_id, user_id, week_start_date, week_end_date, activities_completed, new_milestones_achieved, total_engagement_minutes, average_engagement_level, top_categories[], ai_summary, created_at
- `user_streaks/{streakId}`
  - user_id, baby_id, current_streak, longest_streak, last_activity_date, created_at, updated_at

Note: For per-user filtering, store `user_id` in documents and use security rules to restrict access.

---

## 9) Security Rules

See `firestore.rules` in this folder. Deploy:
```bash
firebase deploy --only firestore:rules
```

---

## 10) Indexes

See `firestore.indexes.json`. Deploy:
```bash
firebase deploy --only firestore:indexes
```

---

## 11) Cloud Functions (APIs)

Use HTTPS Functions for APIs defined in `api_specifications.md`:
- `generateDailyActivities`
- `generateWeeklyAdvice`
- `calculateProgressMetrics`
- `updateStreak`
- `logActivity`
- `completeMilestone`

Recommended stack:
- Node 20 runtime
- TypeScript
- `firebase-admin` and `firebase-functions`
- OpenAI via `OPENAI_API_KEY` set in functions config:
```bash
firebase functions:config:set openai.key="sk-..."
```

Deploy:
```bash
firebase deploy --only functions
```

---

## 12) Seed Data

Use `sample_milestones_seed.json` and import with the Firestore Import/Export tool or a small one-off script.

---

## 13) Local Emulators (Optional)

```bash
firebase emulators:start --only firestore,functions
```

- Configure Flutter to connect to local emulators when `kDebugMode`.

---

## 14) Analytics

- Use Firebase Analytics or keep Mixpanel. You can run both.

---

## 15) Notifications

- Add FCM setup later in Phase 9 (Launch Prep).

---

You're set to use Firebase as the backend for Baby Maths.
